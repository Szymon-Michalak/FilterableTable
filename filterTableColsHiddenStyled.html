<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wyszukiwarka Badań</title>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/choices.js/public/assets/styles/choices.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap');

        body {
            font-family: 'Roboto', Arial, sans-serif;
            font-size: 14px;
            line-height: 1.7;
            color: #747474;
            background-color: #fff;
            margin: 0;
            padding: 0;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        h1.table-title {
            text-align: center;
            font-size: 28px;
            font-weight: 200;
            color: #333333;
            margin-bottom: 20px;
        }

        .form-group {
            margin: 0 auto 30px;
            text-align: center;
            width: 60%;
        }

        label {
            font-weight: 500;
            color: #333333;
            font-size: 16px;
        }

        select.form-control,
        .choices__inner {
            width: 100%;
            padding: 10px;
            font-size: 14px;
            color: #333;
            background-color: #fff;
            border: 1px solid #e1e1e1;
            border-radius: 2px;
            height: 40px;
            margin-top: 5px;
            box-sizing: border-box;
        }

        .choices__inner {
            display: flex;
            align-items: center;
            height: auto;
            padding: 8px 10px;
            border-radius: 2px;
            border: 1px solid #e1e1e1;
            background-color: #fff;
            justify-content: left;
            text-align: left;
            font-size: 14px;
            box-sizing: border-box;
        }

        .choices__list--dropdown .choices__item--selectable {
            padding: 8px 10px;
            text-align: left;
            justify-content: left;
            display: flex;
            align-items: left;
            font-size: 14px;
            box-sizing: border-box;
        }

        .choices__list--single .choices__item {
            font-size: 14px;
            color: #333;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
            background-color: transparent;
        }

        th,
        td {
            padding: 14px 20px;
            text-align: left;
            border: 1px solid #e1e1e1;
        }

        th {
            background-color: #f7f7f7;
            font-weight: 500;
            color: #333333;
        }

        tr:nth-child(even) {
            background-color: #f9f9f9;
        }

        .hidden {
            display: none;
        }

        .h-divider {
            width: 100px;
            height: 2px;
            background-color: rgb(232, 7, 7);
            margin: 0 auto 30px;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1 class="table-title">Wyszukiwarka Badań</h1>
        <div class="h-divider"></div>

        <div class="form-group">
            <label for="filters">Wybierz nowotwór, aby zobaczyć dostępne badania:</label>
            <select name="filters" id="filters" class="form-control">
                <!-- Placeholder option -->
                <!-- Options will be generated dynamically here -->
            </select>
        </div>

        <table id="datatable" class="table table-bordered table-striped">
            <thead>
                <tr>
                    <th style="width: 25%;">Badanie</th>
                    <th style="width: 50%;">Mutacje</th>
                    <th class="hidden" style="width: 0;">Nowotwór</th>
                    <th style="width: 20%;">Link</th>
                </tr>
            </thead>
            <tbody>
                <!-- Initially empty -->
            </tbody>
        </table>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/choices.js/public/assets/scripts/choices.min.js"></script>
    <script src="dataSet.js"></script>
    <script>

        // Initialize Choices.js
        const choices = new Choices('#filters', {
            placeholder: true,
            placeholderValue: 'Wybierz',
            itemSelectText: 'Wybierz nowotwór',
            searchEnabled: true
        });

        function populateTable(data) {
            const tableBody = document.querySelector('#datatable tbody');
            tableBody.innerHTML = ''; // Clear existing rows to avoid duplication

            if (data.length === 0) {
                // If no data, display the empty state message
                const emptyStateMessage = document.createElement('tr');
                const td = document.createElement('td');
                td.colSpan = 3; // Span across all visible columns
                td.textContent = "Użyj wyszukiwarki powyżej, aby wyświetlić dostępne badania";
                td.style.textAlign = "center"; // Center align the message
                emptyStateMessage.appendChild(td);
                tableBody.appendChild(emptyStateMessage);
            } else {
                // Populate the table with data
                data.forEach(row => {
                    const tr = document.createElement('tr');
                    row.forEach((cell, index) => {
                        const td = document.createElement('td');

                        if (index === 3) { // If it's the URL column
                            const a = document.createElement('a');
                            a.href = cell;
                            a.textContent = "Idź na stronę badania";
                            a.target = "_blank"; // Open link in a new tab
                            td.appendChild(a);
                        } else if (index !== 2) { // Skip the "Nowotwór" column
                            td.textContent = cell;
                        }

                        if (index !== 2) { // Append the cell to the row if it's not the hidden column
                            tr.appendChild(td);
                        }
                    });
                    tableBody.appendChild(tr); // Add row to table
                });
            }
        }

        function populateFilterOptions(data) {
            const uniqueIllnesses = [...new Set(data.map(row => row[2]))]; // Extract unique "Nowotwór"
            uniqueIllnesses.forEach(illness => {
                choices.setChoices([
                    {
                        value: illness,
                        label: illness,
                        selected: false,
                        disabled: false
                    }
                ], 'value', 'label', false);
            });
        }

        function filterTable() {
            const selectedIllness = document.querySelector('#filters').value;
            const filteredData = selectedIllness ?
                dataSet.filter(row => row[2] === selectedIllness) :
                []; // Show no entries if no valid selection
            populateTable(filteredData); // Update table with filtered data
        }

        // Initial setup
        populateFilterOptions(dataSet); // Populate filter options first
        populateTable([]); // Ensure the table shows the empty state message on load

        document.querySelector('#filters').addEventListener('change', filterTable);
    </script>
</body>

</html>